<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>予約フォーム</title>
  <style>
    /* 基本的なスタイル */
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f8f8f8;
      color: #333;
      margin: 0;
      padding: 0;
      
    }
    h1 {
      text-align: center;
      color: #FFF;
      margin-top: 20px;
      background-color: #4CAF50;
      padding: 10px 0;
    }
    .title {
      font-size: 1.6em;
      color: #4CAF50;
      margin-bottom: 10px;
      text-align: center;
    }
    .date-container {
      display: flex;
      flex-direction: column;
      margin-bottom: 20px;
      padding-bottom: 20px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .input-wrapper {
      margin: 10px;
    }
    .input-label {
      font-size: 1.2em;
      margin-bottom: 5px;
      display: block;
    }
    .input-select,
    .input-field,
    .input-textarea {
      font-size: 1em;
      padding: 10px;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #f9f9f9;
      transition: border-color 0.3s ease;
    }
    .input-select:focus,
    .input-field:focus,
    .input-textarea:focus {
      outline: none;
      border-color: #4CAF50;
      background-color: #fff;
    }
    button {
      padding: 12px;
      font-size: 1.5em;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      height: 100px;
    }
    button:hover {
      background-color: #45a049;
    }
    #other-input-container {
      display: none;
    }
    #addSecondChoice, #addThirdChoice {
  margin: 10px 0; /* 上下に10pxの余白を追加 */
  height: 60px; /* ボタンの高さを少し小さく */
  font-size: 1.5em; /* フォントサイズを少し小さく */
}
/* スタイリストカードコンテナを横並びに */
#stylist-container {
  display: flex;
  gap: 20px; /* カード間のスペース */
  justify-content: center; /* 横中央揃え */
  flex-wrap: wrap; /* 画面幅が狭い場合に折り返し可能に */
  margin: 20px 0;
}

/* 個々のカードのスタイル */
.stylist-card {
  width: 200px;
  border: 1px solid #ddd;
  border-radius: 10px;
  overflow: hidden;
  text-align: center;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease;
  background-color: #fff;
}

.stylist-card:hover {
  transform: translateY(-10px); /* ホバーで浮き上がるエフェクト */
}

/* スタイリスト画像のスタイル */
.stylist-image img {
  width: 100%;
  height: auto;
  border-bottom: 1px solid #ddd;
}

/* スタイリスト情報 */
.stylist-info {
  padding: 10px;
}

.stylist-info h3 {
  margin: 10px 0;
  font-size: 18px;
  color: #333;
}

.stylist-info p {
  margin: 0;
  font-size: 14px;
  color: #666;
}
/* 選択時のカードのスタイル */
.stylist-card.selected {
  border: 2px solid #4CAF50; /* 緑の枠線 */
  box-shadow: 0 8px 10px rgba(0, 0, 0, 0.15);
  background-color: #f9fff9; /* 少し緑がかった背景色 */
}

/* 通常カードのスタイル */
.stylist-card {
  cursor: pointer; /* カーソルをクリック可能に */
  transition: all 0.3s ease;
}

/* 土日を赤く表示 */
.red-day {
  color: red;  /* LIFFのページ内では適用されます */
}

.hidden {
  display: none;
}

/* 送信ボタンのスタイル */
#submitReservation {
  padding: 10px 20px;
  background-color: #4CAF50;
  color: white;
  border: none;
  cursor: pointer;
  font-size: 32px;
}

#submitReservation:hover {
  background-color: #4CAF50;
}

/* モーダル関連 */
.modal {
  display: none;
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.4);
}

.modal-content {
  background-color: #fefefe;
  margin: 15% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
  height: 80%;
  overflow: auto;
  font-size: 20px;
}

.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

.btn {
  padding: 10px 20px;
  background-color: #4CAF50;
  color: white;
  border: none;
  cursor: pointer;
  font-size: 30px;
}

.btn:hover {
  background-color: #007bb5;
}
.reservationDetails{
   font-size: 300px;
}
  </style>
  
</head>

<body>
  
  <script src="https://static.line-scdn.net/liff/2.1/sdk.js"></script>
  <h1>OASIS<br>予約希望フォーム</h1>

  <form id="reservationForm">
    <!-- 名前 -->
    <h2 class="title">予約者名</h2>
    <div class="input-wrapper">
      <label for="name" class="input-label">予約者名:</label>
      <input type="text" id="name" name="name" placeholder="オアシス太郎" class="input-field" required><br><br>
    </div>

    <!-- 第1希望 -->
    <h2 class="title">第1希望</h2>
    <div class="date-container">
      <div class="input-wrapper">


      <div class="input-wrapper">
        <label for="day1" class="input-label">日:</label>
        <select id="day1" name="day1" class="input-select" required></select>
      </div>

      <div class="input-wrapper">
        <label for="time1" class="input-label">時間:</label>
        <select id="time1" name="time1" class="input-select" required>
          <!-- 時間の選択肢 -->
          <option value="9:00">9:00</option>
          <option value="10:00">10:00</option>
          <option value="11:00">11:00</option>
          <option value="12:00">12:00</option>
          <option value="13:00">13:00</option>
          <option value="14:00">14:00</option>
          <option value="15:00">15:00</option>
          <option value="16:00">16:00</option>
          <option value="17:00">17:00</option>
          <option value="18:00">18:00</option>
        </select>
      </div>
    </div>

    <!-- 希望2 / 希望3の追加ボタン -->
    <button type="button" id="addSecondChoice">第2希望を追加</button>
    <div id="secondChoice"></div>
    

    

    <button type="button" id="addThirdChoice">第3希望を追加</button>
    <div id="thirdChoice"></div>

<!-- 備考 -->
<h2 class="title">メニュー:</h2>
<div class="input-wrapper">
  <label for="menu" class="input-label">ご希望メニュー</label>
  <textarea id="menu" name="menu" class="input-field" rows="4" placeholder="(例)カットとカラーとトリートメント"></textarea>
</div>


   
<!--スタッフ-->
<h2 class="title">担当スタイリスト:</h2>
<div id="stylist-container">
  <!-- 必ずフォームの中か適切な場所にこの要素を追加 -->
<input type="hidden" id="selectedStylistInput" name="stylist">
<div class="stylist-card" data-stylist="指名なし">
  <div class="stylist-image">
    <img src="LINE_ALBUM_スタッフ写真_241130_1.jpg" alt="指名なし">

  </div>
  <div class="stylist-info">
    <h3>指名なし</h3>
  
  </div>
</div>
<div class="stylist-card" data-stylist="岡崎富之">
    <div class="stylist-image">
      <img src="LINE_ALBUM_スタッフ写真_241130_3.jpg" alt="岡崎富之">
    </div>
    <div class="stylist-info">
      <h3>岡崎富之</h3>
      <p>オーナー</p>
    </div>
  </div>
  <div class="stylist-card" data-stylist="岡崎寿美子">
    <div class="stylist-image">
      <img src="LINE_ALBUM_スタッフ写真_241130_2.jpg" alt="岡崎寿美子">
    </div>
    <div class="stylist-info">
      <h3>岡崎寿美子</h3>
      <p>店長</p>
    </div>
  </div>
</div>





    <!-- 電話番号 -->
    <h2 class="title">電話番号:</h2>
    <div class="input-wrapper">
      <label for="phoneNumber" class="input-label">電話番号:</label>
      <input type="text" id="phoneNumber" class="input-field" placeholder="例: 090-1234-5678 または 09012345678" required>
    </div>

    <!-- 備考 -->
    <h2 class="title">備考:</h2>
    <div class="input-wrapper">
      <label for="comments" class="input-label">ご要望・コメント:</label>
      <textarea id="comments" name="comments" class="input-field" rows="4" placeholder="ご要望があればご記入ください"></textarea>
    </div>

    

<!-- 予約確認モーダル -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>予約内容確認</h2>
    <pre id="reservationDetails"></pre>
    <button id="confirmReservation" class="btn">予約する</button>
    <button id="cancelReservation" class="btn">キャンセル</button>
  </div>
</div>
<!-- フォーム送信ボタン -->
<button id="submitReservation" class="btn">送信</button>
  </form>

 


  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/versions/2.22.3/sdk.js"></script>

  <script>
liff.init({
  liffId: '2006621786-8K7V4W3M'
}).then(() => {
  console.log('LIFF initialized');
  // フォームを表示する
  document.getElementById('reservationForm').classList.remove('hidden');
}).catch((error) => {
  console.error('LIFF initialization failed:', error);
});

   // 営業する特別な日（祝日など）
const specialWorkingDays = [
  '2024-12-23'  // 例: 12月23日（月曜日）を営業日として追加
];

// 休暇日を追加 (通常の休日)
const holidays = [
  '2024-12-25',  // 休業日
  '2024-01-01'   // 休業日
];

function generateDates() {
  const today = new Date();
  const maxDays = 180;  // 半年分の日付を生成
  const dates = [];
  // 今日の日付を追加
  const formattedToday = `${today.getFullYear()}-${(today.getMonth() + 1)
    .toString()
    .padStart(2, '0')}-${today.getDate().toString().padStart(2, '0')}`;
  const weekdayToday = ["日", "月", "火", "水", "木", "金", "土"][today.getDay()];
  const isWeekendToday = (today.getDay() === 0 || today.getDay() === 6);
  dates.push({
    date: formattedToday,
    weekday: weekdayToday,
    isWeekend: isWeekendToday
  });
  for (let i = 0; i < maxDays; i++) {
    const nextDate = new Date(today);
    nextDate.setDate(today.getDate() + i);

    const dayOfWeek = nextDate.getDay();

    // 月曜日と火曜日は除外
    if (dayOfWeek === 1 || dayOfWeek === 2) continue;

    // 日付をフォーマット
    const formattedDate = `${nextDate.getFullYear()}-${(nextDate.getMonth() + 1)
      .toString()
      .padStart(2, '0')}-${nextDate.getDate().toString().padStart(2, '0')}`;

    // 休暇日リストに含まれていれば、その日をスキップ
    if (holidays.includes(formattedDate)) continue;

    // 曜日を取得
    const weekday = ["日", "月", "火", "水", "木", "金", "土"][nextDate.getDay()];

    // 土日なら赤色をつける
    const isWeekend = (dayOfWeek === 0 || dayOfWeek === 6);  // 日曜日(0)または土曜日(6)
    const dateWithStyle = {
      date: formattedDate,
      weekday: weekday,
      isWeekend: isWeekend
    };

    dates.push(dateWithStyle);
  }

  return dates;
}

function populateDateOptions(selectId) {
  const daySelect = document.getElementById(selectId);
  const dates = generateDates();

  // 既存の選択肢をクリア
  daySelect.innerHTML = '';

  dates.forEach((dateObj, index) => {
    const option = document.createElement('option');
    option.value = dateObj.date;

    // 日付と曜日を適切に表示
    option.textContent = `${dateObj.date} (${dateObj.weekday})`;

    // 土日にはクラス "red-day" を追加
    if (dateObj.isWeekend) {
      option.classList.add('red-day');
    }

    // 初期選択（第1希望のデフォルト選択を今日に設定）
    if (index === 0) {
      option.selected = true;
    }

    daySelect.appendChild(option);
  });
}

document.getElementById('phoneNumber').addEventListener('input', function (e) {
  const phoneInput = e.target.value;
  const isValid = /^(\d{2,4}-?\d{2,4}-?\d{4})$/.test(phoneInput); // ハイフンあり・なし対応
  if (!isValid) {
    e.target.setCustomValidity('電話番号は正しい形式で入力してください（例: 090-1234-5678 または 09012345678）');
  } else {
    e.target.setCustomValidity('');
  }
});
 // 名前と電話番号の自動入力
 const nameInput = document.getElementById("name");
  const phoneInput = document.getElementById("phoneNumber");

  // 名前と電話番号の記憶
  nameInput.value = localStorage.getItem("name") || '';
  phoneInput.value = localStorage.getItem("phoneNumber") || '';

  // 名前と電話番号を保存
  nameInput.addEventListener('input', function() {
    localStorage.setItem("name", nameInput.value);
  });
  phoneInput.addEventListener('input', function() {
    localStorage.setItem("phoneNumber", phoneInput.value);
  });


    // 日付更新処理
    function updateDays(monthId, dayId) {
      const month = parseInt(document.getElementById(monthId).value);
      const year = 2024;
      const daysInMonth = new Date(year, month, 0).getDate();
  
      let daysOptions = '';
      for (let i = 1; i <= daysInMonth; i++) {
        daysOptions += `<option value="${i}">${i}日</option>`;
      }
  
      const daysSelect = document.getElementById(dayId);
      daysSelect.innerHTML = daysOptions;
    }
  
    // スタイリスト選択
    document.querySelectorAll('.stylist-card').forEach(card => {
      card.addEventListener('click', () => {
        document.querySelectorAll('.stylist-card').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        document.querySelector('#selectedStylistInput').value = card.dataset.stylist;
      });
    });
  
     // 第2希望の追加
  document.getElementById('addSecondChoice').addEventListener('click', function () {
    const secondChoiceDiv = document.getElementById('secondChoice');
    if (!secondChoiceDiv.innerHTML) {
      secondChoiceDiv.innerHTML = `
        <h2 class="title">第2希望</h2>
        <div class="input-wrapper">
          <label for="day2" class="input-label">日付:</label>
          <select id="day2" name="day2" class="input-select" required></select>
        </div>
        <div class="input-wrapper">
          <label for="time2" class="input-label">時間:</label>
          <select id="time2" name="time2" class="input-select" required>
            ${[...Array(10).keys()].map(i => `<option value="${9 + i}:00">${9 + i}:00</option>`).join('')}
          </select>
        </div>`;
      populateDateOptions('day2');
    } else {
      secondChoiceDiv.innerHTML = '';
    }
  });
  
   // 第3希望の追加
  document.getElementById('addThirdChoice').addEventListener('click', function () {
    const thirdChoiceDiv = document.getElementById('thirdChoice');
    if (!thirdChoiceDiv.innerHTML) {
      thirdChoiceDiv.innerHTML = `
        <h2 class="title">第3希望</h2>
        <div class="input-wrapper">
          <label for="day3" class="input-label">日付:</label>
          <select id="day3" name="day3" class="input-select" required></select>
        </div>
        <div class="input-wrapper">
          <label for="time3" class="input-label">時間:</label>
          <select id="time3" name="time3" class="input-select" required>
            ${[...Array(10).keys()].map(i => `<option value="${9 + i}:00">${9 + i}:00</option>`).join('')}
          </select>
        </div>`;
      populateDateOptions('day3');
    } else {
      thirdChoiceDiv.innerHTML = '';
    }
  });
   // 初期化
   window.onload = function() {
    populateDateOptions('day1');
  };


    // 送信処理
 // 予約フォーム送信時
document.getElementById('submitReservation').addEventListener('click', function (event) {
  event.preventDefault(); // デフォルトの送信を防止

  // 入力内容の取得
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phoneNumber').value.trim();
  const menu = document.getElementById('menu').value.trim();
  const comments = document.getElementById('comments').value.trim();
  const stylist = document.getElementById('selectedStylistInput')?.value.trim() || '';

  // 入力チェック（名前と電話番号は必須）
  if (!name) {
    alert('名前を入力してください。');
    return;
  }

  if (!phone.match(/^0\d{1,4}-?\d{1,4}-?\d{4}$/)) {
    alert('電話番号は「09012345678」または「090-1234-5678」の形式で入力してください。');
    return;
  }

  // 第1～第3希望を取得
  const preferences = ['1', '2', '3'].map(num => ({
    date: document.getElementById(`day${num}`)?.value || '',
    time: document.getElementById(`time${num}`)?.value || '',
  })).filter(pref => pref.date && pref.time); // 空の希望を除外

  // 予約詳細の確認内容を作成
document.getElementById('reservationDetails').textContent = `予約希望内容:
名前: ${name}
電話番号: ${phone}
ご希望メニュー: ${menu}
担当スタイリスト: ${stylist}
${preferences.map((pref, index) => `第${index + 1}希望: ${pref.date} ${pref.time}`).join('\n')}
備考: ${comments}`;

  // モーダルに予約内容を表示
  document.getElementById('modal').style.display = 'block';
  document.getElementById('modal').classList.remove('hidden');
});

// 予約を確定するボタン
document.getElementById("confirmReservation").addEventListener("click", function() {
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phoneNumber').value.trim();
  const menu = document.getElementById('menu').value.trim();
  const stylist = document.getElementById('selectedStylistInput')?.value.trim() || '';
  const comments = document.getElementById('comments').value.trim();
  const preferences = ['1', '2', '3'].map(num => ({
    date: document.getElementById(`day${num}`)?.value || '',
    time: document.getElementById(`time${num}`)?.value || '',
  })).filter(pref => pref.date && pref.time);

  // 予約詳細メッセージ作成
  let message = `予約者名: ${name}\n`;
  preferences.forEach((pref, index) => {
    const date = new Date(2024, pref.month - 1, pref.day);
    const weekday = ["日", "月", "火", "水", "木", "金", "土"][date.getDay()];
    message += `第${index + 1}希望: ${pref.month}月${pref.day}日 (${weekday}) ${pref.time}\n`;
  });
  message += `メニュー: ${menu}\n担当スタイリスト: ${stylist}\n電話番号: ${phone}\nコメント: ${comments}`;

  // LINEメッセージ送信
  liff.sendMessages([{ type: 'text', text: message }])
    .then(() => {
      alert('予約希望が送信されました！');
      liff.closeWindow();
    }).catch(error => {
      alert('エラーが発生しました: ' + error.message);
    });

  // モーダルを閉じる
  document.getElementById('modal').style.display = 'none';
});

// キャンセルボタン
document.getElementById('cancelReservation').addEventListener('click', function () {
  // モーダルを閉じる
  document.getElementById('modal').style.display = 'none';
});

// モーダル外をクリックしたら閉じる
window.addEventListener("click", function(event) {
  if (event.target === document.getElementById("modal")) {
    document.getElementById("modal").style.display = "none";
  }
});
  
    // ページロード時処理
    document.addEventListener('DOMContentLoaded', () => {
      populateDateOptions('day1');
    });


    </script>
  
  
</body>
</html>
